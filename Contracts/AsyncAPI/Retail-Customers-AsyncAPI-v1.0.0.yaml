asyncapi: 3.0.0
info:
  title: Retail Customers Service Messaging API
  version: 1.0.0
  description: Messaging API for the Retail Customers service, handling customer-related events and notifications
  license:
    name: Proprietary
  contact:
    name: Development Team
servers:
  rabbitmq-dev:
    host: localhost:5672
    protocol: amqp
    description: Development RabbitMQ server
  rabbitmq-prod:
    host: rabbitmq-server:5672
    protocol: amqp
    description: Production RabbitMQ server
defaultContentType: application/json
channels:
  inventoryUpdatedEvent:
    address: inventorydomain.topic.exchange/inventory.updated.event
    description: Channel for receiving inventory update events from the Products service
    messages:
      inventoryUpdated:
        $ref: '#/components/messages/InventoryUpdatedEvent'
    operations:
      receiveInventoryUpdated:
        action: receive
        summary: Receive inventory updated event
        description: Customer service receives inventory update notifications to process customer notifications
operations:
  receiveInventoryUpdated:
    action: receive
    channel:
      $ref: '#/channels/inventoryUpdatedEvent'
    summary: Receive inventory updated event
    description: Customer service subscribes to inventory update events to notify customers about order status changes
components:
  messages:
    InventoryUpdatedEvent:
      name: InventoryUpdatedEvent
      title: Inventory Updated Event
      summary: Event published when inventory is updated after an order
      contentType: application/json
      payload:
        $ref: '#/components/schemas/InventoryUpdatedEvent'
      examples:
        - name: InventoryUpdatedExample
          summary: Example of inventory updated event
          payload:
            customerId: "123e4567-e89b-12d3-a456-426614174000"
            orderId: "987fcdeb-51a2-43d7-8f9e-123456789abc"
            orderDate: "2024-01-15T10:30:00Z"
            totalAmount: 299.99
            lineItems:
              - skuId: "456e7890-e89b-12d3-a456-426614174001"
                qty: 2
                unitPrice: 149.99
                totalPrice: 299.98
              - skuId: "789e0123-e89b-12d3-a456-426614174002"
                qty: 1
                unitPrice: 0.01
                totalPrice: 0.01
  schemas:
    InventoryUpdatedEvent:
      type: object
      required:
        - customerId
        - orderId
        - orderDate
        - totalAmount
        - lineItems
      properties:
        customerId:
          type: string
          format: uuid
          description: Unique identifier of the customer who placed the order
          example: "123e4567-e89b-12d3-a456-426614174000"
        orderId:
          type: string
          format: uuid
          description: Unique identifier of the order
          example: "987fcdeb-51a2-43d7-8f9e-123456789abc"
        orderDate:
          type: string
          format: date-time
          description: Date and time when the order was created
          example: "2024-01-15T10:30:00Z"
        totalAmount:
          type: number
          format: decimal
          description: Total amount of the order
          minimum: 0
          example: 299.99
        lineItems:
          type: array
          description: List of items in the order
          items:
            $ref: '#/components/schemas/LineItem'
          minItems: 1
    LineItem:
      type: object
      required:
        - skuId
        - qty
        - unitPrice
        - totalPrice
      properties:
        skuId:
          type: string
          format: uuid
          description: Unique identifier of the product SKU
          example: "456e7890-e89b-12d3-a456-426614174001"
        qty:
          type: integer
          description: Quantity of the product ordered
          minimum: 1
          example: 2
        unitPrice:
          type: number
          format: decimal
          description: Price per unit of the product
          minimum: 0
          example: 149.99
        totalPrice:
          type: number
          format: decimal
          description: Total price for this line item (qty * unitPrice)
          minimum: 0
          example: 299.98
  securitySchemes:
    userPassword:
      type: userPassword
      description: RabbitMQ username and password authentication
