asyncapi: 3.0.0
info:
  title: Retail Orders Write Service
  version: 1.0.0
  description: Messaging API for the Retail Orders Write service, handling order creation and processing events
channels:
  orderCreatedEvent:
    address: orderdomain.topic.exchange/order.created.event
    messages:
      OrderCreatedEvent:
        $ref: '#/components/messages/OrderCreatedEvent'
  orderUpdatedEvent:
    address: orderdomain.topic.exchange/order.updated.event
    messages:
      OrderUpdatedEvent:
        $ref: '#/components/messages/OrderUpdatedEvent'
  orderCancelledEvent:
    address: orderdomain.topic.exchange/order.cancelled.event
    messages:
      OrderCancelledEvent:
        $ref: '#/components/messages/OrderCancelledEvent'
  orderCompletedEvent:
    address: orderdomain.topic.exchange/order.completed.event
    messages:
      OrderCompletedEvent:
        $ref: '#/components/messages/OrderCompletedEvent'
operations:
  sendOrderCreated:
    action: send
    channel:
      $ref: '#/channels/orderCreatedEvent'
    messages:
      - $ref: '#/channels/orderCreatedEvent/messages/OrderCreatedEvent'
  sendOrderUpdated:
    action: send
    channel:
      $ref: '#/channels/orderUpdatedEvent'
    messages:
      - $ref: '#/channels/orderUpdatedEvent/messages/OrderUpdatedEvent'
  sendOrderCancelled:
    action: send
    channel:
      $ref: '#/channels/orderCancelledEvent'
    messages:
      - $ref: '#/channels/orderCancelledEvent/messages/OrderCancelledEvent'
  sendOrderCompleted:
    action: send
    channel:
      $ref: '#/channels/orderCompletedEvent'
    messages:
      - $ref: '#/channels/orderCompletedEvent/messages/OrderCompletedEvent'
components:
  messages:
    OrderCreatedEvent:
      payload:
        type: object
        required:
          - eventId
          - eventType
          - timestamp
          - orderId
          - customerId
          - orderItems
          - totalAmount
        properties:
          eventId:
            type: string
            format: uuid
            description: Unique identifier for the event
          eventType:
            type: string
            enum: [OrderCreated]
            description: Type of the event
          timestamp:
            type: string
            format: date-time
            description: When the event occurred
          orderId:
            type: string
            format: uuid
            description: Unique identifier for the order
          customerId:
            type: string
            format: uuid
            description: ID of the customer who placed the order
          orderItems:
            type: array
            items:
              $ref: '#/components/schemas/OrderItem'
            description: Items in the order
            minItems: 1
          totalAmount:
            type: number
            format: decimal
            description: Total amount of the order
            minimum: 0
          shippingAddress:
            $ref: '#/components/schemas/Address'
    OrderUpdatedEvent:
      payload:
        type: object
        required:
          - eventId
          - eventType
          - timestamp
          - orderId
          - changes
        properties:
          eventId:
            type: string
            format: uuid
            description: Unique identifier for the event
          eventType:
            type: string
            enum: [OrderUpdated]
            description: Type of the event
          timestamp:
            type: string
            format: date-time
            description: When the event occurred
          orderId:
            type: string
            format: uuid
            description: Unique identifier for the order
          changes:
            type: object
            description: Fields that were changed
            additionalProperties: true
    OrderCancelledEvent:
      payload:
        type: object
        required:
          - eventId
          - eventType
          - timestamp
          - orderId
          - reason
        properties:
          eventId:
            type: string
            format: uuid
            description: Unique identifier for the event
          eventType:
            type: string
            enum: [OrderCancelled]
            description: Type of the event
          timestamp:
            type: string
            format: date-time
            description: When the event occurred
          orderId:
            type: string
            format: uuid
            description: Unique identifier for the order
          reason:
            type: string
            description: Reason for cancellation
    OrderCompletedEvent:
      payload:
        type: object
        required:
          - eventId
          - eventType
          - timestamp
          - orderId
          - completedAt
        properties:
          eventId:
            type: string
            format: uuid
            description: Unique identifier for the event
          eventType:
            type: string
            enum: [OrderCompleted]
            description: Type of the event
          timestamp:
            type: string
            format: date-time
            description: When the event occurred
          orderId:
            type: string
            format: uuid
            description: Unique identifier for the order
          completedAt:
            type: string
            format: date-time
            description: When the order was completed
  schemas:
    OrderItem:
      type: object
      required:
        - productId
        - quantity
        - unitPrice
      properties:
        productId:
          type: string
          format: uuid
          description: Unique identifier for the product
        quantity:
          type: integer
          description: Quantity of the product
          minimum: 1
        unitPrice:
          type: number
          format: decimal
          description: Price per unit
          minimum: 0
        totalPrice:
          type: number
          format: decimal
          description: Total price for this line item
          minimum: 0
    Address:
      type: object
      properties:
        street:
          type: string
          description: Street address
        city:
          type: string
          description: City
        state:
          type: string
          description: State or province
        zipCode:
          type: string
          description: ZIP or postal code
        country:
          type: string
          description: Country