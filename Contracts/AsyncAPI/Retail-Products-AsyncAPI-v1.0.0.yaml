asyncapi: 3.0.0
info:
  title: Retail Products Service
  version: 1.0.0
  description: Messaging API for the Retail Products service, handling product inventory and order processing events
channels:
  orderCreatedEvent:
    address: orderdomain.topic.exchange/order.created.event
    messages:
      OrderCreatedEvent:
        $ref: '#/components/messages/OrderCreatedEvent'
  inventoryUpdatedEvent:
    address: inventorydomain.topic.exchange/inventory.updated.event
    messages:
      InventoryUpdatedEvent:
        $ref: '#/components/messages/InventoryUpdatedEvent'
  inventoryErrorEvent:
    address: rollback.topic.exchange/inventory.error.event
    messages:
      InventoryErrorEvent:
        $ref: '#/components/messages/InventoryErrorEvent'
operations:
  receiveOrderCreated:
    action: receive
    channel:
      $ref: '#/channels/orderCreatedEvent'
    messages:
      - $ref: '#/channels/orderCreatedEvent/messages/OrderCreatedEvent'
  sendInventoryUpdated:
    action: send
    channel:
      $ref: '#/channels/inventoryUpdatedEvent'
    messages:
      - $ref: '#/channels/inventoryUpdatedEvent/messages/InventoryUpdatedEvent'
  sendInventoryError:
    action: send
    channel:
      $ref: '#/channels/inventoryErrorEvent'
    messages:
      - $ref: '#/channels/inventoryErrorEvent/messages/InventoryErrorEvent'
components:
  messages:
    OrderCreatedEvent:
      payload:
        type: object
        required:
          - customerId
          - orderId
          - orderDate
          - totalAmount
          - lineItems
        properties:
          customerId:
            type: string
            format: uuid
            description: Unique identifier of the customer who placed the order
          orderId:
            type: string
            format: uuid
            description: Unique identifier of the order
          orderDate:
            type: string
            format: date-time
            description: Date and time when the order was created
          totalAmount:
            type: number
            format: decimal
            description: Total amount of the order
            minimum: 0
          lineItems:
            type: array
            description: List of items in the order
            items:
              $ref: '#/components/schemas/LineItem'
            minItems: 1
    InventoryUpdatedEvent:
      payload:
        type: object
        required:
          - customerId
          - orderId
          - orderDate
          - totalAmount
          - lineItems
        properties:
          customerId:
            type: string
            format: uuid
            description: Unique identifier of the customer who placed the order
          orderId:
            type: string
            format: uuid
            description: Unique identifier of the order
          orderDate:
            type: string
            format: date-time
            description: Date and time when the order was created
          totalAmount:
            type: number
            format: decimal
            description: Total amount of the order
            minimum: 0
          lineItems:
            type: array
            description: List of items in the order
            items:
              $ref: '#/components/schemas/LineItem'
            minItems: 1
    InventoryErrorEvent:
      payload:
        type: object
        required:
          - customerId
          - orderId
          - orderDate
          - totalAmount
        properties:
          customerId:
            type: string
            format: uuid
            description: Unique identifier of the customer who placed the order
          orderId:
            type: string
            format: uuid
            description: Unique identifier of the order
          orderDate:
            type: string
            format: date-time
            description: Date and time when the order was created
          totalAmount:
            type: number
            format: decimal
            description: Total amount of the order
            minimum: 0
          errorMessage:
            type: string
            description: Description of the error that occurred during inventory processing
  schemas:
    LineItem:
      type: object
      required:
        - skuId
        - qty
        - unitPrice
        - totalPrice
      properties:
        skuId:
          type: string
          format: uuid
          description: Unique identifier of the product SKU
        qty:
          type: integer
          description: Quantity of the product ordered
          minimum: 1
        unitPrice:
          type: number
          format: decimal
          description: Price per unit of the product
          minimum: 0
        totalPrice:
          type: number
          format: decimal
          description: Total price for this line item (qty * unitPrice)
          minimum: 0